<div class="col-sm-12" *ngIf="hasError">
  <span class="text-center">Information indisponible</span>
</div>

<div class="custom-datatable mu-crud" *ngIf="!hasError">
  <div class="content-heading">{{ pageTitle }}</div>
  <div class="panel panel-default panel-mu">
    <div class="panel-body">
      <!-- SALER -->
      <div class="form-group">
        <div class="col-xs-2 text-right line-height-30">
          <label>Ambassadeur</label>
        </div>
        <div class="col-xs-10 line-height-30">
          <mat-form-field>
            <mat-select class="form-control" [(ngModel)]="selectedUser" (selectionChange)="updateMissionList()">
              <mat-option *ngFor="let user of users" [value]="user">{{ user?.firstName }} {{ user?.lastName }}</mat-option>
            </mat-select>
          </mat-form-field>
        </div>
      </div>
      <!-- MISSIONS -->
      <div class="form-group mission-list">
        <div class="col-xs-2 text-right title">
          <label>Mission(s)</label>
        </div>
        <div class="col-xs-10">
          <div class="custom-datatable" *ngIf="!hasError" #tableWrapper [hidden]="loadingIndicator">
            <ngx-datatable class='material' [columnMode]="'force'" [headerHeight]="'auto'" [footerHeight]="50"
                [rowHeight]="'auto'" [limit]="currentPageLimit" [rows]='missions' [messages]="messages"
                [selectAllRowsOnPage]="false"
                [selected]="missionSelected" (select)='onSelect($event)'
                [selectionType]="'checkbox'"
                [loadingIndicator]="loadingIndicator">
              <!-- CHECKBOX -->
              <ngx-datatable-column [width]="40" [sortable]="false"
                [canAutoResize]="false"
                [draggable]="false"
                [resizeable]="false"
                [headerCheckboxable]="true"
                [checkboxable]="true">
              </ngx-datatable-column>
              <!-- Communes -->
              <ngx-datatable-column name="Communes" prop="towns" editable="false" [sortable]="false" [resizeable]="false">
                <ng-template ngx-datatable-cell-template let-value="value" let-mission="row">
                  <span class="show" [innerHTML]="value" [tooltip]="mission.getTooltipText()" placement="right"
                    container="body"></span>
                </ng-template>
              </ngx-datatable-column>
              <!-- Status -->
              <ngx-datatable-column name="Status" prop="status" editable="false" [sortable]="false" [resizeable]="false"
                [maxWidth]="120" [minWidth]="120">
              </ngx-datatable-column>
              <!-- Du -->
              <ngx-datatable-column name="Du" prop="startDateF" editable="false" [sortable]="true" [resizeable]="false"
                [maxWidth]="120" [minWidth]="120">
              </ngx-datatable-column>
              <!-- Au -->
              <ngx-datatable-column name="Au" prop="endDateF" editable="false" [sortable]="true" [resizeable]="false"
                [maxWidth]="120" [minWidth]="120">
              </ngx-datatable-column>
              <!-- Logements -->
              <ngx-datatable-column name="Logements" prop="totalHousingNumber" editable="false" [sortable]="false"
                [resizeable]="false" [maxWidth]="120" [minWidth]="120">
              </ngx-datatable-column>
              <ngx-datatable-footer>
                <ng-template ngx-datatable-footer-template let-rowCount="rowCount" let-pageSize="currentPageLimit"
                  let-curPage="curPage" let-offset="offset" let-isVisible="isVisible">
                  <datatable-pager [pagerLeftArrowIcon]="'datatable-icon-left'" [pagerRightArrowIcon]="'datatable-icon-right'"
                    [pagerPreviousIcon]="'datatable-icon-prev'" [pagerNextIcon]="'datatable-icon-skip'" [page]="curPage"
                    [size]="currentPageLimit" [count]="rowCount" [hidden]="missions?.length < 10"
                    (change)="table.onFooterPage($event);updatePager($event)">
                  </datatable-pager>
                  <div class="datatable-pager page-limit" [hidden]="missions?.length < 10">
                    <ul id="per-page" class="pager">
                      <li *ngFor="let option of pageLimitOptions" (click)="onLimitChange(option.value)" class="pages"
                        [ngClass]="{ 'active': currentPageLimit === option.value }">
                        <a href>{{ option.value }}</a>
                      </li>
                    </ul>
                  </div>
                </ng-template>
              </ngx-datatable-footer>
            </ngx-datatable>
            <div class="clearfix"></div>
            <!-- ACTION -->
            <div class="row text-center botton-action">
              <button type="button" (click)="onSubmit()" [disabled]='missionSelected?.length === 0' class="mb-1 btn btn-mu btn-default">Valider</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
